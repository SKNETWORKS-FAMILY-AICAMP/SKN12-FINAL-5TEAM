<!DOCTYPE html>
<html>
<head>
  <title>AI 모의 면접 시스템</title>
</head>
<body>
  <h2>AI 모의 면접 시스템</h2>
  <p id="question">면접관 질문: 본인의 강점을 말해주세요.</p>
  <p id="status">현재: 사용자 답변 중</p>
  <button onclick="startInterview()">면접 시작</button>

  <script>
    // 기본 설정
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = 'ko-KR';

    let silenceTimer;
    let currentSpeaker = 'user'; // 'user' 또는 'chunsik'

    // 질문 시퀀스 실행
    function startInterview() {
      const turnOrder = ['user', 'chunsik']; // 사용자 먼저
      askQuestion("본인의 강점을 말해주세요.", turnOrder);
    }

    // 질문 함수
    function askQuestion(questionText, order) {
      document.getElementById('question').textContent = '면접관 질문: ' + questionText;
      let index = 0;
      proceedToNextSpeaker();

      function proceedToNextSpeaker() {
        if (index >= order.length) {
          document.getElementById('status').textContent = '면접 종료';
          return;
        }

        currentSpeaker = order[index];
        index++;

        if (currentSpeaker === 'user') {
          document.getElementById('status').textContent = '현재: 사용자 답변 중';
          listenToUser();
        } else {
          document.getElementById('status').textContent = '현재: 춘식이 답변 중';
          simulateChunsikAnswer();
        }
      }

      function listenToUser() {
        recognition.start();
        let userSpoke = false;

        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          console.log("사용자 음성 인식:", transcript);
          userSpoke = true;
        };

        recognition.onstart = () => {
          // 10초 안 말하면 다음으로 넘어감
          silenceTimer = setTimeout(() => {
            if (!userSpoke) {
              console.log("10초간 무음 → 춘식이에게 발언권 이관");
              recognition.stop();
            }
          }, 10000);
        };

        recognition.onend = () => {
          clearTimeout(silenceTimer);
          proceedToNextSpeaker();
        };
      }

      function simulateChunsikAnswer() {
        // 춘식이 응답을 2초 기다린 후 표시
        setTimeout(() => {
          console.log("춘식이: 저는 협업 능력이 강점입니다.");
          document.getElementById('status').textContent = '춘식이: 저는 협업 능력이 강점입니다.';
          proceedToNextSpeaker();
        }, 2000);
      }
    }
  </script>
</body>
</html>
